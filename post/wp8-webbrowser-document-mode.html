<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>关于 WP8 中 WebBrowser 控件的文档模式 | @chaoming.edc blog</title>
  <meta name="author" content="chaoming.edc|blastmann">
  
  <meta name="description" content="track my learning">
  
  
  <meta name="keywords" content="windowsphone,windows,xaml,developer,iOS,OSX,productive">
  
  
  <meta property="og:title" content="关于 WP8 中 WebBrowser 控件的文档模式"/>
  <meta name="title" content="关于 WP8 中 WebBrowser 控件的文档模式"/>

  <meta property="displaydate" content="2013-05-21T02:39:00.000Z"/>

  <meta property="og:site_name" content="@chaoming.edc blog"/>
  <meta name="copyright" content="@chaoming.edc blog"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta property="og:image" content="undefined"/>
  
   <meta name="google-site-verification" content="nTpmJEYYJgba5eVrpd_dfj1W_Ayr-NjZ1vFvhi5aqzI" />
   <meta name="baidu-site-verification" content="QO84kHVH0w" />
   <link rel="apple-touch-icon" href="/icon.png" />
   <link rel="shortcut icon" href="/favicon.png" >
   <link rel="alternate" href="http://blog.edi-c.com/atom.xml" title="@chaoming.edc blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
  <div id="content" class="inner">
    <aside id="sidebar" class="alignleft">
      <div class="navigationBar">
        <a href="/">@chaoming.edc blog</a>
      </div>
    	
  <nav class="widget" id="menu">
	<ul>
    
      <li class="cell"><a class="next" href="/">Home</a><li>
    
      <li class="cell"><a class="next" href="/archives/">Archives</a><li>
    
      <li class="cell"><a class="next" href="/about/">About</a><li>
    
      <li class="cell"><a class="next" href="/atom.xml">Subscribe</a><li>
    
    </ul>
</nav>

  <div class="widget weibo">
<iframe width="100%" height="100" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=110&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=0&isWeibo=0&isFans=0&uid=newdings&verifier=78e1ee4d&colors=ffffff,ffffff,999,000,ecfbfd&dpc=1"></iframe>
</div>

  

  
<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/IE/" style="font-size: 10.00px;">IE</a><a href="/tags/Swift/" style="font-size: 10.00px;">Swift</a><a href="/tags/WPF/" style="font-size: 10.00px;">WPF</a><a href="/tags/alfred/" style="font-size: 10.00px;">alfred</a><a href="/tags/aspnet/" style="font-size: 10.00px;">aspnet</a><a href="/tags/browser/" style="font-size: 10.00px;">browser</a><a href="/tags/csharp/" style="font-size: 10.00px;">csharp</a><a href="/tags/css3/" style="font-size: 12.50px;">css3</a><a href="/tags/dev/" style="font-size: 10.00px;">dev</a><a href="/tags/diary/" style="font-size: 10.00px;">diary</a><a href="/tags/directx/" style="font-size: 10.00px;">directx</a><a href="/tags/fiddler/" style="font-size: 12.50px;">fiddler</a><a href="/tags/google/" style="font-size: 10.00px;">google</a><a href="/tags/iOS/" style="font-size: 10.00px;">iOS</a><a href="/tags/ie/" style="font-size: 10.00px;">ie</a><a href="/tags/ie11/" style="font-size: 10.00px;">ie11</a><a href="/tags/javascript/" style="font-size: 10.00px;">javascript</a><a href="/tags/js/" style="font-size: 10.00px;">js</a><a href="/tags/mac/" style="font-size: 10.00px;">mac</a><a href="/tags/markdown/" style="font-size: 10.00px;">markdown</a><a href="/tags/mvc/" style="font-size: 10.00px;">mvc</a><a href="/tags/note/" style="font-size: 10.00px;">note</a><a href="/tags/notes/" style="font-size: 17.50px;">notes</a><a href="/tags/plugin/" style="font-size: 10.00px;">plugin</a><a href="/tags/productivity/" style="font-size: 10.00px;">productivity</a><a href="/tags/programming/" style="font-size: 12.50px;">programming</a><a href="/tags/python/" style="font-size: 10.00px;">python</a><a href="/tags/reflow/" style="font-size: 10.00px;">reflow</a><a href="/tags/sqlite/" style="font-size: 10.00px;">sqlite</a><a href="/tags/st2/" style="font-size: 17.50px;">st2</a><a href="/tags/summaries/" style="font-size: 10.00px;">summaries</a><a href="/tags/system/" style="font-size: 10.00px;">system</a><a href="/tags/vim/" style="font-size: 10.00px;">vim</a><a href="/tags/vs2012/" style="font-size: 10.00px;">vs2012</a><a href="/tags/vs2013/" style="font-size: 10.00px;">vs2013</a><a href="/tags/web/" style="font-size: 10.00px;">web</a><a href="/tags/webdev/" style="font-size: 20.00px;">webdev</a><a href="/tags/webview/" style="font-size: 12.50px;">webview</a><a href="/tags/windows/" style="font-size: 15.00px;">windows</a><a href="/tags/winrt/" style="font-size: 17.50px;">winrt</a>
  </div>
</div>


    	<footer id="footer" class="inner"><div class="copyright">
  
  &copy; 2015 chaoming.edc|blastmann
  
</div>



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-51731334-1', 'edi-c.com');
  ga('send', 'pageview');

</script></footer>
    </aside>


    <div id="hidden-navigationBar" class="navigationBar">
      <a href="/">@chaoming.edc blog</a>
    </div>
    <div id="main-col" class="alignright">
    <div id="wrapper">
      
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title">关于 WP8 中 WebBrowser 控件的文档模式</h1>
  

      <time datetime="2013-05-21T02:39:00.000Z"><a href="/post/wp8-webbrowser-document-mode.html">5月 21 2013</a></time>
      
  </header>
    <div class="entry">
      
        <p>IE 有个很诡异的地方就是：如果 HTML 文档里面没有声明 <code>&lt;!DOCTYPE&gt;</code> 的话，将会触发其「<a href="http://zh.wikipedia.org/zh-cn/%E6%80%AA%E5%BC%82%E6%A8%A1%E5%BC%8F" target="_blank">怪异模式</a>」。同时，WP8 上的 <code>WebBrowser</code> 控件本身有个 Bug 就是当我们使用 <code>NavigateToString()</code> 时，如果 HTML 代码中对 <code>&lt;!DOCTYPE&gt;</code> 进行声明了话，那 <code>WebBrowser</code> 将不能渲染该 HTML 代码（<a href="http://mikaelkoskinen.net/webbrowser-navigatetostring-broken-in-windows-phone-8-and-also-affects-windows-phone-7-apps-solution-included/" target="_blank">参考文章</a>）。</p>
<p>该参考文章给出的方法是利用独立存储来解决这个问题，代码如下：</p>
<pre><code><span class="keyword">var</span> client = <span class="keyword">new</span> WebClient(); 
<span class="keyword">var</span> content = <span class="keyword">await</span> client.DownloadStringTaskAsync(url);
<span class="keyword">var</span> store = IsolatedStorageFile.GetUserStoreForApplication();

<span class="keyword">using</span> (<span class="keyword">var</span> writeFile = <span class="keyword">new</span> StreamWriter(<span class="keyword">new</span> IsolatedStorageFileStream(<span class="string">"htmlcontent.html"</span>, FileMode.Create, FileAccess.Write, store))) 
{ 
    writeFile.Write(content); 
    writeFile.Close(); 
}

<span class="keyword">var</span> uri = <span class="keyword">new</span> Uri(<span class="string">"htmlcontent.html"</span>, UriKind.Relative);
WebBrowser.Navigate(uri);
</code></pre><p>PS：记得要给我们的 HTML 文档加上 <code>&lt;!doctype html&gt;</code> ，这样可以让 WebBrowser 运行在 IE10 的模式下面，对 HTML5 的支持最好，而且对 DOM 的操作速度也会快上不少。</p>
<p><strong>2013-05-20更新</strong>：今天看到 StackOverflow 上关于这个问题的另外一个答案（<a href="http://stackoverflow.com/questions/16276833/windows-8-phone-webbrowser-navigatetostring-does-not-work-when-meta-tag-meta-ch" target="_blank">点击进入</a>），<code>WebBrowser</code> 中 <code>NavigateToString()</code> 失效的根本原因应是 <code>String</code> 的编码问题。由于 <code>String</code> 类型的编码是 UTF-16，如果在 HTML 代码中插入 <code>&lt;meta charset=&quot;UTF-8&quot;&gt;</code> 的声明，<code>NavigateToString()</code> 将无法正确显示页面。</p>
<p><strong>2013-05-21相关资料</strong>：</p>
<ul>
<li><a href="http://msdn.microsoft.com/en-us/library/ie/cc288325" target="_blank"><Defining document compatibility></a>，在此文档中有简介 IE 中关于文档模式的一些问题。特别指出 IE9 及以前的版本，浏览器处理 Quirks Mode 的时候页面功能的支持将相当于 IE5.5。</li>
<li><a href="http://msdn.microsoft.com/en-us/library/ie/jj676915(v=vs.85).aspx" target="_blank"><Specifying legacy document modes></a>，此文档主要是介绍不同的 <code>&lt;!DOCTYPE&gt;</code> 下对应的文档模式。</li>
</ul>
<h4 id="关于_WebBrowser_的文档模式检测">关于 WebBrowser 的文档模式检测</h4>
<p>很简单地过程，只要使用 <code>documentMode()</code> 输出一下文档模式即可。简单测试代码：</p>
<ul>
<li><p>XAML:</p>
<pre><code>  <span class="tag">&lt;<span class="title">StackPanel</span>&gt;</span>
      <span class="tag">&lt;<span class="title">TextBlock</span> <span class="attribute">FontSize</span>=<span class="value">"{StaticResource PhoneFontSizeLarge}"</span> <span class="attribute">Margin</span>=<span class="value">"{StaticResource PhoneMargin}"</span>&gt;</span>doctype and flexbox test<span class="tag">&lt;/<span class="title">TextBlock</span>&gt;</span>
      <span class="tag">&lt;<span class="title">phone:WebBrowser</span> <span class="attribute">Name</span>=<span class="value">"wb1"</span> <span class="attribute">IsScriptEnabled</span>=<span class="value">"True"</span> <span class="attribute">Height</span>=<span class="value">"300"</span> <span class="attribute">Margin</span>=<span class="value">"{StaticResource PhoneMargin}"</span>&gt;</span><span class="tag">&lt;/<span class="title">phone:WebBrowser</span>&gt;</span>

      <span class="tag">&lt;<span class="title">phone:WebBrowser</span> <span class="attribute">Name</span>=<span class="value">"wb2"</span> <span class="attribute">IsScriptEnabled</span>=<span class="value">"True"</span> <span class="attribute">Height</span>=<span class="value">"300"</span> <span class="attribute">Margin</span>=<span class="value">"{StaticResource PhoneMargin}"</span>&gt;</span><span class="tag">&lt;/<span class="title">phone:WebBrowser</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">StackPanel</span>&gt;</span>
</code></pre></li>
<li><p>CS:</p>
<pre><code>  using Microsoft.Phone.Controls;
  namespace PhoneApp3
  {
      public partial class MainPage : PhoneApplicationPage
      {
          // Constructor
          public MainPage()
          {
              InitializeComponent();

              var s2 = @"<span class="doctype">&lt;!doctype html&gt;</span>
                      <span class="tag">&lt;<span class="title">html</span> <span class="attribute">lang</span>=<span class="value">'en'</span>&gt;</span>
                      <span class="tag">&lt;<span class="title">head</span>&gt;</span>
                      <span class="tag">&lt;<span class="title">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="title">title</span>&gt;</span>
                      <span class="tag">&lt;<span class="title">style</span> <span class="attribute">type</span>=<span class="value">'text/css'</span>&gt;</span><span class="css">
                      <span class="class">.flex</span><span class="rules">{<span class="rule"><span class="attribute">display</span>:<span class="value"> -ms-flexbox</span></span>;<span class="rule">}</span></span>
                      <span class="class">.flex</span> <span class="tag">div</span><span class="rules">{<span class="rule"><span class="attribute">-ms-flex</span>:<span class="value"><span class="number">1</span> <span class="number">0</span> auto</span></span>; <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">200</span>px</span></span>; <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">200</span>px</span></span>;<span class="rule">}</span></span>
                      <span class="class">.red</span><span class="rules">{<span class="rule"><span class="attribute">background</span>:<span class="value"> red</span></span>;<span class="rule">}</span></span>
                      <span class="class">.blue</span><span class="rules">{<span class="rule"><span class="attribute">background</span>:<span class="value"> blue</span></span>;<span class="rule">}</span></span>
                      <span class="class">.green</span><span class="rules">{<span class="rule"><span class="attribute">background</span>:<span class="value"> green</span></span>;<span class="rule">}</span></span>
                      </span><span class="tag">&lt;/<span class="title">style</span>&gt;</span>
                      <span class="tag">&lt;/<span class="title">head</span>&gt;</span>
                      <span class="tag">&lt;<span class="title">body</span>&gt;</span>
                      <span class="tag">&lt;<span class="title">p</span>&gt;</span>DocumentMode: <span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">'mode'</span> <span class="attribute">style</span>=<span class="value">'color:red'</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">p</span>&gt;</span>
                      <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">'flex'</span>&gt;</span>
                      <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">'red'</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>
                      <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">'blue'</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>
                      <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">'green'</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>
                      <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
                      <span class="tag">&lt;/<span class="title">body</span>&gt;</span>
                      <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">
                      <span class="keyword">var</span> m = document.getElementById(<span class="string">'mode'</span>);
                      m.innerText = document.documentMode;
                      </span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
                      <span class="tag">&lt;/<span class="title">html</span>&gt;</span>
                      ";

              var s3 = @"
                      <span class="tag">&lt;<span class="title">html</span> <span class="attribute">lang</span>=<span class="value">'en'</span>&gt;</span>
                      <span class="tag">&lt;<span class="title">head</span>&gt;</span>
                      <span class="tag">&lt;<span class="title">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="title">title</span>&gt;</span>
                      <span class="tag">&lt;<span class="title">style</span> <span class="attribute">type</span>=<span class="value">'text/css'</span>&gt;</span><span class="css">
                      <span class="class">.flex</span><span class="rules">{<span class="rule"><span class="attribute">display</span>:<span class="value"> -ms-flexbox</span></span>;<span class="rule">}</span></span>
                      <span class="class">.flex</span> <span class="tag">div</span><span class="rules">{<span class="rule"><span class="attribute">-ms-flex</span>:<span class="value"><span class="number">1</span> <span class="number">0</span> auto</span></span>; <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">200</span>px</span></span>; <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">200</span>px</span></span>;<span class="rule">}</span></span>
                      <span class="class">.red</span><span class="rules">{<span class="rule"><span class="attribute">background</span>:<span class="value"> red</span></span>;<span class="rule">}</span></span>
                      <span class="class">.blue</span><span class="rules">{<span class="rule"><span class="attribute">background</span>:<span class="value"> blue</span></span>;<span class="rule">}</span></span>
                      <span class="class">.green</span><span class="rules">{<span class="rule"><span class="attribute">background</span>:<span class="value"> green</span></span>;<span class="rule">}</span></span>
                      </span><span class="tag">&lt;/<span class="title">style</span>&gt;</span>
                      <span class="tag">&lt;/<span class="title">head</span>&gt;</span>
                      <span class="tag">&lt;<span class="title">body</span>&gt;</span>
                      <span class="tag">&lt;<span class="title">p</span>&gt;</span>DocumentMode: <span class="tag">&lt;<span class="title">span</span> <span class="attribute">id</span>=<span class="value">'mode'</span> <span class="attribute">style</span>=<span class="value">'color:red'</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span><span class="tag">&lt;/<span class="title">p</span>&gt;</span>
                      <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">'flex'</span>&gt;</span>
                      <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">'red'</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>
                      <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">'blue'</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>
                      <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">'green'</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>
                      <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
                      <span class="tag">&lt;/<span class="title">body</span>&gt;</span>
                      <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">
                      <span class="keyword">var</span> m = document.getElementById(<span class="string">'mode'</span>);
                      m.innerText = document.documentMode;
                      </span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
                      <span class="tag">&lt;/<span class="title">html</span>&gt;</span>
                      ";

              wb1.NavigateToString(s2);
              wb2.NavigateToString(s3);
          }
      }
  }
</code></pre></li>
</ul>
<p>启动程序即可得到测试结果，我们应该尽可能地让浏览器保持在最新的文档模式中工作，保持最好的 HTML 支持和 JS 性能。</p>
<p><strong>2013-05-22更新</strong>：WebBrowser 控件在显示大量文字的时候性能很差，原因未明。</p>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="http://weibo.com/newdings/"><strong>@cmm是muffinman_</strong></a> - 5月 21 2013</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://blog.edi-c.com"><strong>@chaoming.edc blog</strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
	 
     		  
       		
  
  <div class="tags">
    <a href="/tags/webdev/">webdev</a>, <a href="/tags/wp8/">wp8</a>
  </div>

     		  
       	 
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">留言</h1>




<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'blastmannonscriptogram'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</section>

</div>
    </div>
    <div class="tabbar" onload="divideTabBar()">
	
      <div class="tabbaritem"><a class="next" href="/">Home</a></div>
    
      <div class="tabbaritem"><a class="next" href="/archives/">Archives</a></div>
    
      <div class="tabbaritem"><a class="next" href="/about/">About</a></div>
    
      <div class="tabbaritem"><a class="next" href="/atom.xml">Subscribe</a></div>
    
</div>


  </div>

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.0.min.js"></script>
</body>
</html>