<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>@chaoming.edc blog</title>
  <meta name="author" content="chaoming.edc|blastmann">
  
  <meta name="description" content="track my learning">
  
  
  <meta name="keywords" content="windowsphone,windows,xaml,developer,iOS,OSX,productive">
  
  

  

  <meta property="og:site_name" content="@chaoming.edc blog"/>
  <meta name="copyright" content="@chaoming.edc blog"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta property="og:image" content="undefined"/>
  
   <meta name="google-site-verification" content="nTpmJEYYJgba5eVrpd_dfj1W_Ayr-NjZ1vFvhi5aqzI" />
   <meta name="baidu-site-verification" content="QO84kHVH0w" />
   <link rel="apple-touch-icon" href="/icon.png" />
   <link rel="shortcut icon" href="/favicon.png" >
   <link rel="alternate" href="http://blog.edi-c.com/atom.xml" title="@chaoming.edc blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
  <div id="content" class="inner">
    <aside id="sidebar" class="alignleft">
      <div class="navigationBar">
        <a href="/">@chaoming.edc blog</a>
      </div>
    	
  <nav class="widget" id="menu">
	<ul>
    
      <li class="cell"><a class="next" href="/">Home</a><li>
    
      <li class="cell"><a class="next" href="/archives/">Archives</a><li>
    
      <li class="cell"><a class="next" href="/about/">About</a><li>
    
      <li class="cell"><a class="next" href="/atom.xml">Subscribe</a><li>
    
    </ul>
</nav>

  <div class="widget weibo">
<iframe width="100%" height="100" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=110&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=0&isWeibo=0&isFans=0&uid=newdings&verifier=78e1ee4d&colors=ffffff,ffffff,999,000,ecfbfd&dpc=1"></iframe>
</div>

  

  
<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/IE/" style="font-size: 10.00px;">IE</a><a href="/tags/Swift/" style="font-size: 10.00px;">Swift</a><a href="/tags/WPF/" style="font-size: 10.00px;">WPF</a><a href="/tags/alfred/" style="font-size: 10.00px;">alfred</a><a href="/tags/aspnet/" style="font-size: 10.00px;">aspnet</a><a href="/tags/browser/" style="font-size: 10.00px;">browser</a><a href="/tags/csharp/" style="font-size: 10.00px;">csharp</a><a href="/tags/css3/" style="font-size: 12.50px;">css3</a><a href="/tags/dev/" style="font-size: 10.00px;">dev</a><a href="/tags/diary/" style="font-size: 10.00px;">diary</a><a href="/tags/directx/" style="font-size: 10.00px;">directx</a><a href="/tags/fiddler/" style="font-size: 12.50px;">fiddler</a><a href="/tags/google/" style="font-size: 10.00px;">google</a><a href="/tags/iOS/" style="font-size: 10.00px;">iOS</a><a href="/tags/ie/" style="font-size: 10.00px;">ie</a><a href="/tags/ie11/" style="font-size: 10.00px;">ie11</a><a href="/tags/javascript/" style="font-size: 10.00px;">javascript</a><a href="/tags/js/" style="font-size: 10.00px;">js</a><a href="/tags/mac/" style="font-size: 10.00px;">mac</a><a href="/tags/markdown/" style="font-size: 10.00px;">markdown</a><a href="/tags/mvc/" style="font-size: 10.00px;">mvc</a><a href="/tags/note/" style="font-size: 10.00px;">note</a><a href="/tags/notes/" style="font-size: 17.50px;">notes</a><a href="/tags/plugin/" style="font-size: 10.00px;">plugin</a><a href="/tags/productivity/" style="font-size: 10.00px;">productivity</a><a href="/tags/programming/" style="font-size: 12.50px;">programming</a><a href="/tags/python/" style="font-size: 10.00px;">python</a><a href="/tags/reflow/" style="font-size: 10.00px;">reflow</a><a href="/tags/sqlite/" style="font-size: 10.00px;">sqlite</a><a href="/tags/st2/" style="font-size: 17.50px;">st2</a><a href="/tags/summaries/" style="font-size: 10.00px;">summaries</a><a href="/tags/system/" style="font-size: 10.00px;">system</a><a href="/tags/vim/" style="font-size: 10.00px;">vim</a><a href="/tags/vs2012/" style="font-size: 10.00px;">vs2012</a><a href="/tags/vs2013/" style="font-size: 10.00px;">vs2013</a><a href="/tags/web/" style="font-size: 10.00px;">web</a><a href="/tags/webdev/" style="font-size: 20.00px;">webdev</a><a href="/tags/webview/" style="font-size: 12.50px;">webview</a><a href="/tags/windows/" style="font-size: 15.00px;">windows</a><a href="/tags/winrt/" style="font-size: 17.50px;">winrt</a>
  </div>
</div>


    	<footer id="footer" class="inner"><div class="copyright">
  
  &copy; 2014 chaoming.edc|blastmann
  
</div>



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-51731334-1', 'edi-c.com');
  ga('send', 'pageview');

</script></footer>
    </aside>


    <div id="hidden-navigationBar" class="navigationBar">
      <a href="/">@chaoming.edc blog</a>
    </div>
    <div id="main-col" class="alignright">
    <div id="wrapper">
      
  
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/post/webviewjavascriptbridge-for-winrt.html">WebViewJavascriptBridge For WinRT</a></h1>
  

      <time datetime="2014-12-06T12:37:51.000Z"><a href="/post/webviewjavascriptbridge-for-winrt.html">12月 6 2014</a></time>
      
  </header>
    <div class="entry">
      
        <p>直奔主题，之前说了<a href="/post/a-solution-for-any-hosts-to-notify-winrt-81-webview.html">如何在WinRT 8.1下面通过<code>ScriptNotify</code>接收页面JS对Native Code发送的消息</a>。虽然示例工程也说得比较清楚，但是没有封装成一个类似iOS/OSX下面的<a href="https://github.com/marcuswestin/WebViewJavascriptBridge" target="_blank">WebViewJavscriptBridge</a>插件。于是这两天闲来无事，将其封装成Runtime Component。Repo：<a href="https://github.com/blastmann/WebViewJavascriptBridgeRT" target="_blank">WebViewJavascriptBridgeRT</a>。</p>
<p>整个Bridge跟iOS下面的封装几乎一样，主体JS也是从那边拿过来改了适配了一下就用了。整体流程在示例App里面写得比较清楚，就不重复写了。主要流程就是：新建桥接-&gt;注册回调接口-&gt;对页面发送消息或调用注册接口。</p>
<p>不同于ObjC，在解析JS回传的JSON时，由于不建议使用<code>dynamic</code>，因此暂时建议在回传的时候统一对结果进行<code>stringify</code>处理，获取到结果的字符串后再自行解析成所需对象。JSON解析引用了JSON.Net，速度还是挺不错的。</p>
<p>暂时发现在WebView里面回调本地代码似乎有点性能问题，后面需要再跟进一下。然后再研究一下回传结果的解析函数能否使用泛型重写，这样似乎能更方便地处理回传结果的解析问题，避免上面的限制。</p>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="http://weibo.com/newdings/"><strong>@cmm是muffinman_</strong></a> - 12月 6 2014</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://blog.edi-c.com"><strong>@chaoming.edc blog</strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/post/compile-a-wxsqlite3-for-winrt.html">编译wxSQLite3 for WinRT</a></h1>
  

      <time datetime="2014-11-22T14:52:55.000Z"><a href="/post/compile-a-wxsqlite3-for-winrt.html">11月 22 2014</a></time>
      
  </header>
    <div class="entry">
      
        <p>原生的SQLite没有实现加解密接口，只留了一个函数入口给开发者自行实现。在Windows下面本身提供了一个跟ADO.NET紧密结合的SQLite，支持加解密。但WinRT上面使用的还是原生的SQLite，这就只能依靠开发者自己去实现一个加解密流程。幸好wxWidget这开源工程里面本来就实现了一个支持AES 128/256位加密的SQLite，只需要将这个wxSQLite按照WinRT的编译流程去编译打包成VSIX包就可以了。具体的实现，我已经把<a href="https://github.com/blastmann/wxSqlite3-WinRT-Project" target="_blank">已编译的包和可编译的源码都放在Github上</a>了，有兴趣的可以去弄一下。</p>
<p>注意点：</p>
<ol>
<li>编译前需要安装好Cygwin、Active Tcl 8.5和zip\unzip命令。</li>
<li>原版的SQLite-Net没有导入和封装加解密函数，同样的在源码里面已经有封装好的了。</li>
<li>个人只测试了加解密和数据库读取能正常工作，不确保在写入的时候会有异常情况发生，欢迎在repo里面留下issue。</li>
</ol>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="http://weibo.com/newdings/"><strong>@cmm是muffinman_</strong></a> - 11月 22 2014</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://blog.edi-c.com"><strong>@chaoming.edc blog</strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/post/easy-way-to-manage-assets-in-visual-studio.html">利用Link大法让Visual Studio工程文件自动更新Assets</a></h1>
  

      <time datetime="2014-11-17T11:50:46.000Z"><a href="/post/easy-way-to-manage-assets-in-visual-studio.html">11月 17 2014</a></time>
      
  </header>
    <div class="entry">
      
        <p>前段时间在做<a href="http://www.windowsphone.com/s?appid=fb0ce559-ea2a-4447-abac-599da5e90e50" target="_blank">MH4 Dex RT</a>的时候，Ping叔给了一堆图片资源（几千张），都是一些小图标。每次做完图片处理之后都要重新拉到工程里面，做了好几次的时候就觉得超麻烦。每次往VS里面拖图片都会被它自动复制一份，拖的时候VS还会卡住好长一段时间。想了半天要不要用脚本解决这问题，最后发现我大VS竟然提供了一个特别的功能叫”Add as Link”。简单修改一下工程文件就可以让VS自动更新工程目录下的工程资源了。</p>
<p>以Universal Project为例，用编辑器打开.Shared目录下面的<code>.projitems</code>文件，进行下面的操作：</p>
<ol>
<li>找到原来的Assets目录声明，一般在某个ItemGroup里面。</li>
<li><p>用下面的XML片段替换：</p>
<pre><code> <span class="tag">&lt;<span class="title">Content</span> <span class="attribute">Include</span>=<span class="value">"$(MSBuildThisFileDirectory)Assets\**\*.*"</span>&gt;</span>
     <span class="tag">&lt;<span class="title">Link</span>&gt;</span>Assets\%(RecursiveDir)%(FileName)%(Extension)<span class="tag">&lt;/<span class="title">Link</span>&gt;</span>
 <span class="tag">&lt;/<span class="title">Content</span>&gt;</span>
</code></pre></li>
<li><p>保存，在VS里面重新加载工程。</p>
</li>
</ol>
<p>如此修改之后，以后在Shared工程里面添加资源后，只要在VS里面进行一次Project Reload即可更新Assets，十分方便快捷。</p>
<p>PS：此方法也适用于一份代码共享多个工程的情况。</p>
<p>PPS：不要尝试在VS里面对Link的资源进行复制、删除等操作。</p>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="http://weibo.com/newdings/"><strong>@cmm是muffinman_</strong></a> - 11月 17 2014</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://blog.edi-c.com"><strong>@chaoming.edc blog</strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/post/a-solution-for-any-hosts-to-notify-winrt-81-webview.html">让WinRT 8.1 Webview支持任意站点下的JS通知</a></h1>
  

      <time datetime="2014-08-04T14:10:00.000Z"><a href="/post/a-solution-for-any-hosts-to-notify-winrt-81-webview.html">8月 4 2014</a></time>
      
  </header>
    <div class="entry">
      
        <h2 id="前言">前言</h2>
<p>在使用WebBrowser\Webview一类的控件时，一般都免不了与JS打交道。从WP7开始，微软的WebBrowser就支持使用<code>ScriptNotify()</code>进行JS与C#代码间的交互，到WinRT下的Webview仍然有这么一个API供开发者使用，但适用情况有些许改变。</p>
<h2 id="问题描述">问题描述</h2>
<p>WinRT 8.1下，微软增强了Webview控件的大部分功能，同时也废弃了几个允许脚本通知（ScriptNotify)的属性。关于ScriptNotify，在8.1的帮助文档里面有这么一段注释：</p>
<blockquote>
<p>To enable an external web page to fire the ScriptNotify event when calling window.external.notify, you must include the page’s URI in the ApplicationContentUriRules section of the app manifest. (You can do this in Visual Studio on the Content URIs tab of the Package.appxmanifest designer.) The URIs in this list must use HTTPS and may contain subdomain wildcards (for example, “<a href="https://*.microsoft.com" target="_blank">https://*.microsoft.com</a>“), but they can’t contain domain wildcards (for example, “<a href="https://*.com" target="_blank">https://*.com</a>“ and “<a href="https://*.*" target="_blank">https://*.*</a>“). The manifest requirement does not apply to content that originates from the app package, uses an ms-local-stream:// URI, or is loaded using NavigateToString.<br>Note  If you have more then one subdomain, you must use one wildcard for each subdomain. For example, “<a href="https://*.microsoft.com" target="_blank">https://*.microsoft.com</a>“ matches with “<a href="https://any.microsoft.com" target="_blank">https://any.microsoft.com</a>“ but not with “<a href="https://this.any.microsoft.com" target="_blank">https://this.any.microsoft.com</a>.”<br>These changes do not affect apps compiled for Windows 8, even when running on Windows 8.1.</p>
<p>AllowedScriptNotifyUris, AnyScriptNotifyUri, and AllowedScriptNotifyUrisProperty are not supported in apps compiled for Windows 8.1.</p>
</blockquote>
<p>也就是说，只有在应用开发过程中，开发者主动添加在<code>Package.appxmanifest</code>中的，并且只能是HTTPS下的Uri才可以进行脚本的主动通知。开发者无法直接地对非HTTPS的站点进行JS注入后的主动通知，而且需要维护一个庞大的白名单。</p>
<h2 id="解决思路：微软的示例代码中有一段神奇的注释">解决思路：微软的示例代码中有一段神奇的注释</h2>
<p>在微软给出的Webview示例中，有这么一段注释：</p>
<blockquote>
<p>Content loaded using the NavigateToString() method; or ms-appx-web, ms-appdata, ms-webview-stream:// URI schemes can get the result back automatically. </p>
</blockquote>
<p>有两种情况，Webview可以无视上面描述的通知限制。</p>
<ol>
<li>使用<code>NavigateToString()</code>显示的页面</li>
<li>使用<code>ms-appx-web</code>、<code>ms-appdata</code>和<code>ms-webview-stream://</code>导航显示的页面</li>
</ol>
<p>那么，这个问题就转变成：能否在其它网站页面中引入一个本地页面作为与本地C#代码进行交互呢？</p>
<p>答案是可以的。</p>
<p>经过测试，我们完全可以在应用中引入一个HTML文档，文档中只需要简单地在页面中封装<code>window.external.notify()</code>这个JS函数。然后在任意页面中通过JS创建<code>iframe</code>标签并使用<code>ms-appx-web</code>协议引用这个本地的HTML文档。只要HTML文档可以正常加载，那么问题将转化为：如何对<code>iframe</code>进行跨域通信？</p>
<p>关于<code>iframe</code>的跨域通信，网上有不少的解决方法。在我的示例中只使用了<code>postMessage</code>这个HTML5 API进行通信（不兼容IE8以下）。</p>
<p><img src="https://xbyjdw.bn1.livefilestore.com/y2pB5LW1JARe7w32dZ04XD6eijpeYMoYH9g8tKZKnIoJib-7W5OVK8B5ypBVHG6A0zjIMoYqIanjg6fBOXg86IIro4UTz_isP0gsXvEaF_L9C4/any-uri-notify.png?psid=1" alt="any-uri-notify"></p>
<p>示例代码下载：<a href="https://www.dropbox.com/s/tv2sq7qt9ybuopz/Control_WebView.zip" target="_blank">点击下载</a>。</p>
<p>PS：微软限制JS的通知当然是出于安全性的考虑了，所以我们在使用这种方法的时候，也需要好好考虑一下会不会造成什么安全隐患。另外，我个人是希望JS通知这东西能少则少，毕竟性能也不是很好，建议尽量是减少使用的。</p>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="http://weibo.com/newdings/"><strong>@cmm是muffinman_</strong></a> - 8月 4 2014</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://blog.edi-c.com"><strong>@chaoming.edc blog</strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/post/set-language-in-wp81-dev-power-tools.html">为Windows Phone Developer Power Tools设置语言</a></h1>
  

      <time datetime="2014-07-09T02:15:51.000Z"><a href="/post/set-language-in-wp81-dev-power-tools.html">7月 9 2014</a></time>
      
  </header>
    <div class="entry">
      
        <p>WP8.1 SDK新添加了一个工具叫做<a href="http://msdn.microsoft.com/zh-cn/library/windows/apps/dn629255.aspx" target="_blank">Developer Power Tools</a>，这个工具比以前的Profile工具好用（虽然还是不会用，找内存泄漏太难了）。本文主要是为了解决一个问题：<strong>在中文系统上安装英文的VS2013后，启动Power Tools发现连接的模拟器名字多了一个“zh-HANS”，导致Debug的模拟器和Power Tools启动的模拟器不是同一个的问题</strong>。</p>
<p>废话少说，直接上干货。</p>
<p>设置Power Tools的启动语言，只需要在对应快捷方式的目标路径中添加<code>-language en-US</code>即可，例如：</p>
<pre><code>"C:<span class="command">\Program</span> Files (x86)<span class="command">\Microsoft</span> SDKs<span class="command">\Windows</span> Phone<span class="command">\v</span>8.1<span class="command">\Tools</span><span class="command">\PowerTools</span><span class="command">\PwTools</span>.exe" -language en-US
</code></pre><p>有空补个截图吧。</p>
<p>PS：MSDN文档能不能完善一点，新加一个新工具竟然连使用说明都没有。ETL文件怎么分析也没说，哎。这启动参数还是用JustDecompile反编译出来才发现的。调了半天以为格式是”-language=en-US”，再仔细看才发现是用空格区分的。</p>
<p>PSS：参数用/或者-开头都可以。</p>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="http://weibo.com/newdings/"><strong>@cmm是muffinman_</strong></a> - 7月 9 2014</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://blog.edi-c.com"><strong>@chaoming.edc blog</strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/post/feeling-swift.html">Swift使用感受</a></h1>
  

      <time datetime="2014-07-08T01:59:46.000Z"><a href="/post/feeling-swift.html">7月 8 2014</a></time>
      
  </header>
    <div class="entry">
      
        <h2 id="写在前面">写在前面</h2>
<p>Apple这次发布Swift语言，是想把OC开发者渐渐迁移到新平台上面吧。暂时来说，Swift具备了很多OC不具备的语言特性，更方便智商不够用的开发者来到iOS平台进行开发。但是，Swift离取代OC的日子还有点远。因为Swift的特性还不能完全覆盖OC的所有特性（举个例子：KVO暂时还没有）。所以未来有一段时间都会是两种语言并行使用。</p>
<p>在Xcode 6正式版还没有出来之前，不建议用Swift来做主力开发语言。因为Xcode 6 Beta对Swift的支持实在是有问题（至少在我的机器上是这样）。智能提示经常提示一些乱七八槽的东西，而且崩溃的机率也很大。</p>
<p>所以，暂时还是学好OC比较有用。虽然Swift更安全更方便，但是用OC先摸一下iOS平台上的坑，还是有必要的。</p>
<p>下面的内容有点乱，随便看看就好。</p>
<h2 id="Swift初体验">Swift初体验</h2>
<h3 id="1-_基础点">1. 基础点</h3>
<ol>
<li>有动态语言的语法特征，但用的是类型推导，是编译型语言</li>
<li>有泛型，个人觉得最直观的体现就是Array和Dictionary终于是强类型的了但还有些很神奇的坑。</li>
<li>可空类型，有助于进行链式调用编写。</li>
<li><del>官方文档上没有发现有<code>public</code> \ <code>private</code>等关键字，全部定义都是公有，这样真没有问题么？虽然类型安全了，但是API编写可能存在比较大的风险。</del> Xcode beta4添加了相关定义，已修正这个问题。</li>
<li>var定义的是变量，let定义的是常量（简单理解）。</li>
<li>…这里想到再补充吧</li>
</ol>
<h3 id="2-_闭包">2. 闭包</h3>
<p>闭包就跟OC里面的Block差不多（Block就是一个语法丑了一点的闭包）。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="code"><pre><span class="type">class</span> HTMLElement: NSObject {
    let <span class="property">name</span>: String
    let <span class="type">text</span>: String?
    
    @lazy var asHTML: () -&gt; String = {
        [unowned self] <span class="keyword">in</span>
        <span class="keyword">if</span> let <span class="type">text</span> = self.<span class="type">text</span> {
<span class="command">            return</span> <span class="string">"&lt;\(self.name)&gt;\(text)&lt;/\(self.name)&gt;"</span>
        } <span class="keyword">else</span> {
<span class="command">            return</span> <span class="string">"&lt;\(self.name) /&gt;"</span>
        }
    }
    
    init(<span class="property">name</span>: String, <span class="type">text</span>: String? = nil) {
        self.<span class="property">name</span> = <span class="property">name</span>
        self.<span class="type">text</span> = <span class="type">text</span>
    }
    
    deinit {
        println(<span class="string">"\(name) is being deinitialized"</span>)
    }
}
</pre></td></tr></table></figure>

<h5 id="Nested_Function也算是一种闭包">Nested Function也算是一种闭包</h5>
<figure class="highlight swift"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre>func makeIncrementor<span class="function"><span class="params">(forIncrement amount: Int)</span> -&gt;</span> <span class="function"><span class="params">()</span> -&gt;</span> Int {
    <span class="reserved">var</span> runningTotal = <span class="number">0</span>
    func incrementor<span class="function"><span class="params">()</span> -&gt;</span> Int {
        runningTotal += amount
        <span class="keyword">return</span> runningTotal
    }
    <span class="keyword">return</span> incrementor
}
</pre></td></tr></table></figure>

<h3 id="3-_泛型（赞）">3. 泛型（赞）</h3>
<p>Swift里面可以使用泛型了，但是使用了泛型的话就不能与OC进行对接，这点需要事先声明。因为泛型不可以与OC进行对接，所以下面的代码会出现链接错误：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="class"><span class="keyword">class</span> <span class="title">errorGenericObject</span><span class="inheritance">&lt;<span class="parent">T</span></span>&gt; : <span class="title">NSObject</span> {</span>
    let <span class="symbol">member:</span> <span class="constant">T</span>
    init(<span class="symbol">aMember:</span> <span class="constant">T</span>) {
        <span class="keyword">self</span>.member = aMember
    }
}
</pre></td></tr></table></figure>

<p>反正我把<code>NSObject</code>的继承去掉之后就可以正常使用了，我觉得Xcode在这个提示上面可以更清晰一些，beta3里面如果有这样的编码，编译时只会提示链接错误，而且错误信息也不是很清晰。</p>
<p>官方文档说可以用数组来处理这种问题：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre><span class="variable">@objc</span> <span class="class"><span class="keyword">class</span> <span class="title">errorObj</span><span class="inheritance">&lt;<span class="parent">T</span></span>&gt; {</span>
    private let <span class="symbol">_member:</span> [<span class="constant">T</span>]
    var <span class="symbol">member:</span> <span class="constant">T</span> {
        <span class="keyword">return</span> _member[<span class="number">0</span>]
    }
    
    init(<span class="symbol">aMember:</span> <span class="constant">T</span>) {
        <span class="keyword">self</span>._member = []
        <span class="keyword">self</span>._member[<span class="number">0</span>] = aMember
    }
}
</pre></td></tr></table></figure>

<p>编译后Swift生成的OC类会是这样的：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>SWIFT_CLASS(<span class="string">"_TtC12TestSwiftApp8errorObj"</span>)
<span class="class"><span class="keyword">@interface</span> <span class="title">errorObj</span></span>
<span class="keyword">@end</span>
</pre></td></tr></table></figure>

<p>即使可以编译过了，但泛型相关的信息也会被抹消掉，结果就是这种泛型类无法在OC下使用。</p>
<h3 id="4-_ARC">4. ARC</h3>
<p>ARC的规则与OC里面差不多，需要解决循环引用的地方都建议使用<code>weak</code>或者<code>unowned</code>。<code>unowned</code>适用于变量总是有值的情况，<code>weak</code>则是对普通变量使用的。标明<code>unowned</code>的变量在使用过程中一定要确保它是非空的，否则会造成异常。</p>
<h2 id="与Objetive-C混合使用">与Objetive-C混合使用</h2>
<h3 id="1-_模块引用">1. 模块引用</h3>
<p>从OC代码中引用Swift模块，只需要OC文件中引入对应的头文件，示例：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="array">#import </span><span class="string">"TestSwiftApp-Swift.h"</span>
</pre></td></tr></table></figure>

<p>需要注意的是，<code>TestSwiftApp</code>这个前缀是在Build Settings是进行设置的。可以设置对应的<code>Product Module Name</code>来修改（默认是空，所以使用<code>Product Name</code>进行代替）。</p>
<p>如果要在Swift中使用OC代码，则需要在一个名字为<code>#ProductName#-Bridging-Header.h</code>的头文件中引用所有需要暴露给Swift的模块头文件。</p>
<h3 id="2-_与OC_API的结合使用">2. 与OC API的结合使用</h3>
<h4 id="a-_构造函数的差别">a. 构造函数的差别</h4>
<p>OBJECTIVE-C</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="built_in">UITableView</span> *myTableView = [[<span class="built_in">UITableView</span> alloc] initWithFrame:CGRectZero style:UITableViewStyleGrouped];
In Swift, you <span class="keyword">do</span> <span class="keyword">this</span>:
</pre></td></tr></table></figure>

<p>SWIFT</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>let myTableView: <span class="built_in">UITableView</span> = <span class="built_in">UITableView</span>(frame: CGRectZero, style: <span class="variable">.Grouped</span>)
</pre></td></tr></table></figure>

<h4 id="b-_id类型与AnyObject">b. id类型与AnyObject</h4>
<p>挺容易理解，id类型在Swift里面对应的就是AnyObject了。与OC混合使用的时候，难免会遇到NSArray、NSDictionary相互转换的情况，从OC转换过来的数组和字典里面所存的数据都是用AnyObject，转换后可以通过<code>as?</code>进行安全的类型转换。</p>
<h3 id="3-_@objc标记">3. @objc标记</h3>
<p>如果你的类不是继承自NSObject或者OC编写的类，但又想兼容OC，可以使用<code>@objc</code>标记。</p>
<h3 id="4-_内省方法">4. 内省方法</h3>
<p>OC里面可以使用<code>isKindOfClass:</code>之类的方法进行对象的类型判断，Swift中可以直接通过<code>is</code>、<code>as</code>这两个关键字进行代替。</p>
<h3 id="5-_OC混合编程中无法使用的Swift特性">5. OC混合编程中无法使用的Swift特性</h3>
<ul>
<li>Generics：泛型</li>
<li>Tuples：元组</li>
<li>Enumerations defined in Swift：定义在Swift中的枚举类型</li>
<li>Structures defined in Swift：定义在Swift中的值类型</li>
<li>Top-level functions defined in Swift：定义在Swift中的最上层函数？（一些工具类的函数可能会写在一个Swift文件中，但不属于任何类）</li>
<li>Global variables defined in Swift：全局变量</li>
<li>Typealiases defined in Swift：类型别名</li>
<li>Swift-style variadics：Swift的可变参数</li>
<li>Nested types：nested类型</li>
<li>Curried functions：咖喱函数（我的智商暂时不够用，理解不了）</li>
</ul>
<h2 id="似乎有些坑的地方">似乎有些坑的地方</h2>
<p>都已经到Xcode beta3了，Swift开发环境还是一堆堆的坑，下面简单记录一下。</p>
<h3 id="1-_Xcode自动补全没反应，索引服务经常挂掉。">1. Xcode自动补全没反应，索引服务经常挂掉。</h3>
<p>坑爹的是我输入一个<code>for</code>，感觉它应该给我提示自动补全一个for循环吧，结果它竟然给我提示<code>fork()</code>！而且提示里面还没有for循环的选项可以用！</p>
<h3 id="2-_delegate模式的使用">2. delegate模式的使用</h3>
<figure class="highlight swift"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="code"><pre><span class="comment">//@class_protocol protocol ModalViewControllerDelegate {</span>
@objc protocol ModalViewControllerDelegate {
    func modalViewControllerDidClickedDismissButton(viewController: ModalViewController)
}

class ModalViewController: <span class="built_in">UIViewController</span> {
    <span class="comment">// 使用weak关键字意图解决循环引用</span>
    <span class="keyword">weak</span> var delegate: ModalViewControllerDelegate?
    override func viewDidLoad() {
        <span class="keyword">super</span><span class="variable">.viewDidLoad</span>()

        <span class="comment">// Do any additional setup after loading the view.</span>
        <span class="keyword">if</span> let sView = <span class="keyword">self</span><span class="variable">.view</span> {
            sView<span class="variable">.backgroundColor</span> = <span class="built_in">UIColor</span><span class="variable">.lightGrayColor</span>()
            
            <span class="keyword">if</span> let button = <span class="built_in">UIButton</span><span class="variable">.buttonWithType</span>(UIButtonType<span class="variable">.System</span>) as? <span class="built_in">UIButton</span> {
                button<span class="variable">.frame</span> = <span class="built_in">CGRect</span>(x: <span class="number">80</span>, y: <span class="number">210</span>, width: <span class="number">160</span>, height: <span class="number">40</span>)
                button<span class="variable">.setTitle</span>(<span class="string">"Dismiss me"</span>, forState: UIControlState<span class="variable">.Normal</span>)
                button<span class="variable">.addTarget</span>(<span class="keyword">self</span>, action: <span class="string">"buttonClicked:"</span>, forControlEvents: UIControlEvents<span class="variable">.TouchUpInside</span>)
                
                <span class="keyword">self</span><span class="variable">.view</span><span class="variable">.addSubview</span>(button)
            }
        }
    }

    override func didReceiveMemoryWarning() {
        <span class="keyword">super</span><span class="variable">.didReceiveMemoryWarning</span>()
        <span class="comment">// Dispose of any resources that can be recreated.</span>
    }
    
    func buttonClicked(sender: AnyObject) {
        <span class="keyword">self</span><span class="variable">.delegate</span>?<span class="variable">.modalViewControllerDidClickedDismissButton</span>(<span class="keyword">self</span>)
    }
}
</pre></td></tr></table></figure>

<p>使用delegate模式时，一般都会用<code>weak</code>去解决循环引用。但直接使用<code>weak</code>的话，编译器会提示</p>
<blockquote>
<p><code>weak</code> cannot be applied to non-class type <code>xxxx</code></p>
</blockquote>
<p><a href="http://stackoverflow.com/questions/24066304/how-can-i-make-a-weak-protocol-reference-in-pure-swift-w-o-objc" target="_blank">StackOverflow上说这种情况</a>需要对protocol添加关键字<code>@objc</code>或者<code>@class_protocol</code>。但现阶段使用后者的话，运行的时候程序会Crash。这是Bug吧？</p>
<h3 id="3-_[unowned_self]导致崩溃">3. <code>[unowned self]</code>导致崩溃</h3>
<p>OC里面，当我们在使用heap block的时候，会注意到如果在block中对self进行引用的话，很容易会造成循环引用导致的内存泄漏。这时我们会使用<code>__weak</code>关键字解决这问题，例如：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>- (<span class="keyword">void</span>)startPolling {
    __<span class="keyword">weak</span> EOCClass *weakSelf = <span class="keyword">self</span>;
    _pollTimer = [NSTimer eoc_scheduledTimerWithTimeInterval:<span class="number">5.0</span>
                                                       block:^{
                                                    EOCClass *strongSelf = weakSelf;
                                                    [strongSelf p_doPoll];
                                                        }
                                                    repeats:<span class="literal">YES</span>];
}
</pre></td></tr></table></figure>

<p>在Swift中，使用属性或方法返回闭包时，官方文档上说也可以使用<code>unowned</code>关键字解决这问题。用<code>weak</code>的话应该也可以，例如：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="code"><pre><span class="regexp">//</span> 使用unowned
<span class="reserved">var</span> <span class="attribute">asHTML</span>: <span class="function"><span class="params">()</span> -&gt;</span> String = {
    [unowned self] <span class="keyword">in</span>
    <span class="keyword">if</span> <span class="reserved">let</span> text = self.text {
        <span class="keyword">return</span> <span class="string">"&lt;\(self.name)&gt;\(text)&lt;/\(self.name)&gt;"</span>
    } <span class="keyword">else</span> {
        <span class="keyword">return</span> <span class="string">"&lt;\(self.name) /&gt;"</span>
    }
}

<span class="regexp">//</span> 使用weak
<span class="reserved">var</span> <span class="attribute">asHTML</span>: <span class="function"><span class="params">()</span> -&gt;</span> String = {
    [weak self] <span class="keyword">in</span>
    <span class="keyword">if</span> <span class="reserved">let</span> text = self?.text {
        <span class="keyword">return</span> <span class="string">"&lt;\(self?.name)&gt;\(text)&lt;/\(self?.name)&gt;"</span>
    } <span class="keyword">else</span> {
        <span class="keyword">return</span> <span class="string">"&lt;\(self?.name) /&gt;"</span>
    }
}
</pre></td></tr></table></figure>

<p>测试结果暂时显示，使用<code>unowned</code>的话会导致Crash。这估计是坑吧……</p>
<h3 id="4-_多线程">4. 多线程</h3>
<p>用Swift重写了一次PrimeFinder，多线程方面还是可以正常使用GCD提供的功能，就是一些block的生成需要注意一下，把语法改一下就好。</p>
<p>由于Swift里面暂时没找到<code>@synchronized</code>这加锁的语法，可以暂时会用下面的代码代替。用<code>NSLock</code>之类的代替也可以。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>objc_sync_enter(self)
<span class="keyword">...</span>
objc_sync_exit(self)
</pre></td></tr></table></figure>

<p>注意一下加锁的对象就好。在重写的时候发现了一个死锁的情况，例如：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="code"><pre>class PrimeFinder {
    var primes: [Int] = []
<span class="keyword">...</span>

    func start() {
<span class="keyword">...</span>
        let isPrime: dispatch_block_t = {
            [weak self] <span class="keyword">in</span>
            <span class="keyword">for</span> (var n = <span class="number">2</span>; n &lt; number; n++) {
                <span class="keyword">if</span> ((number % n) == <span class="number">0</span>) {
                    <span class="keyword">return</span>
                }
            }
            
            objc_sync_enter(self?.primes)
            self?.primes.append(number)
            objc_sync_exit(self?.primes)
        }
<span class="keyword">...</span>
    }
}
</pre></td></tr></table></figure>

<p>在加锁的时候使用的是<code>self?.primes</code>可能为空，导致死锁。如果单独使用一个常量<code>let syncObject: NSObject</code>来代替的话则没有问题。另外，block里面使用<code>unowned</code>似乎是一件很危险的事情，经常会出现Crash。</p>
<h3 id="5-_Playground有何用？">5. Playground有何用？</h3>
<p>新建一个Playground文件，里面有所见即所得的编程体验，编写的代码可以立刻从Playground里面反映出来。但是，<a href="http://stackoverflow.com/questions/24045245/how-to-import-own-classes-from-your-own-project-into-a-playground" target="_blank">对于自定义类来说，在Playground里面暂时无法引用</a>。</p>
<p>简单粗暴的方法是：源码复制粘贴到Playground里面再使用。</p>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="http://weibo.com/newdings/"><strong>@cmm是muffinman_</strong></a> - 7月 8 2014</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://blog.edi-c.com"><strong>@chaoming.edc blog</strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/post/how-to-import-custom-font-in-wp8.html">WP8如何引用自定义字体</a></h1>
  

      <time datetime="2014-06-14T15:34:42.000Z"><a href="/post/how-to-import-custom-font-in-wp8.html">6月 14 2014</a></time>
      
  </header>
    <div class="entry">
      
        <h2 id="前言">前言</h2>
<p>最近重操故业，拿起了PS认真做了个App的设计图，然后就是把设计稿转化成App了。由于设计的时候使用了一些系统不存在的字体，所以只好研究怎么引入自定义的字体。</p>
<h2 id="说一下WP里面对字体的一个特殊处理">说一下WP里面对字体的一个特殊处理</h2>
<p>其实刚开始的时候也没有想着使用自定义字体的，毕竟也只是把Segoe这个字体压缩了一下，在PS里面将它设置成了Condensed。结果发现WP开发的时候，把<code>FontStretch</code>设置成<code>Condensed</code>是没有作用的。原因是：设置字体拉伸这个属性，对应的字体必须支持该样式（即需要Segoe Condensed这个字体），如果不支持，则不应用该属性。</p>
<p>于是，只能想想别的方法：把字体打包到应用里面吧。</p>
<h2 id="引入自定义字体">引入自定义字体</h2>
<p>有这么特殊的处理也就算了，在WP7开始可以正常使用的引用自定义字体的方法，在WP8下面竟然不适用。引用方法如下：</p>
<ol>
<li>将字体复制到工程中，建议使用”Fonts”目录存放</li>
<li>将字体文件在工程中的属性设置为Contents</li>
<li>在XAML文件中需要定义字体的地方，使用”Fonts/MyCustomFont.tff#MyCustomFont”这种语法进行引用</li>
</ol>
<p>需要注意的是：#后面的字体名需要自行打开该字体进行查看，字体名不等于文件名。</p>
<p>本来到这里，这文章也就完了，结果引用完了之后发现没有任何效果。于是继续Google，在<a href="http://nicksnettravels.builttoroam.com/post/2013/06/22/TTF-Font-with-Windows-Phone-8.aspx" target="_blank">TTF Font with Windows Phone 8</a>这文章里面，作者也遇到这个问题。他的最终解决方法是：使用<a href="http://birdfont.org/" target="_blank">BirdFont</a>软件修改字体，换个名字之后重新导出就可以正常引用了。该同学也不明白这是为什么。</p>
<p>PS：该文章里面使用的BirdFont原来是不需要收费的，但最新的版本已经是需要购买才能正常使用（不购买的话只能修改SIL协议下的字体）。不过费用也不贵，是以捐赠的形式进行购买的，最低只需要捐赠1美元就可以买到了。</p>
<p>PPS：这样修改过的字体不知道能不能在商业用途中使用，有这样的风险。</p>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="http://weibo.com/newdings/"><strong>@cmm是muffinman_</strong></a> - 6月 14 2014</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://blog.edi-c.com"><strong>@chaoming.edc blog</strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/post/test-for-google.html">测试一下Google的索引</a></h1>
  

      <time datetime="2014-06-07T14:50:45.000Z"><a href="/post/test-for-google.html">6月 7 2014</a></time>
      
  </header>
    <div class="entry">
      
        <p>最近把Blog迁移到Github Pages之后，发现好几篇Post都没有及时收录。研究了一下，说是建议添加Sitemap都Google站长工具里面。</p>
<p>添加完之后，发布一篇post测试一下。</p>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="http://weibo.com/newdings/"><strong>@cmm是muffinman_</strong></a> - 6月 7 2014</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://blog.edi-c.com"><strong>@chaoming.edc blog</strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/post/handle-scrollviewer-manipulation-events-in-winrt.html">WinRT下ScrollViewer的Manipulation事件如何响应</a></h1>
  

      <time datetime="2014-06-06T04:44:13.000Z"><a href="/post/handle-scrollviewer-manipulation-events-in-winrt.html">6月 6 2014</a></time>
      
  </header>
    <div class="entry">
      
        <h2 id="前言">前言</h2>
<p>WP 8.1发布了，并且官方也宣布了Universal App的开发方式。可以针对Windows 8.1和Windows Phone 8.1的同时开发一个项目。UI部分只需要简单适配一下就可以了，大部分API都是共用的（个人对8.1研究不大深入，这里说的只是个大概的理解，有错误请指正）。</p>
<h2 id="XAML_App和Silverlight_8-1">XAML App和Silverlight 8.1</h2>
<p>8.1环境下面，有个概念要搞清楚：XAML App和Silverlight App不是一回事。虽然大家都用XAML，但8.1 XAML App的UI模型和Silverlight的模型不大一样，而且XAML App支持使用C/C++进行UI编程，这样做起来好像是会对内存控制上好一点。</p>
<p>可惜的是，XAML App暂时还不能完全替代掉Silverlight App，但这肯定是一个趋势。而且看Silverlight App中控件的API在8.1下面基本没有增加（其实我也觉得XAML App里面的控件用起来更爽）。</p>
<h2 id="正题">正题</h2>
<p>说了那么多，下面讲一下这次的正题。在XAML App下，<code>UIElement</code>引入了<code>ManipulationMode</code>的概念。下面是官方解释：</p>
<blockquote>
<p>如果要处理操作事件（例如从您应用程序代码中 UI 元素的 ManipulationStarted），则必须将 ManipulationMode 设置为其他值，而不是 System 或 None。</p>
<p>ManipulationMode 的典型默认值为 System 而不是 None。该值为 System 时，源自该元素的操作可以由根据 直接操作API 的 Windows </p>
<p>]运行时基础结构处理。例如，ScrollViewer 按其控件逻辑处理用户操作，并将它们作为控件的滚动事件处理。System 值还可启用响应操作事件的个性动画。<br>Slider 和 ToggleSwitch 具有默认模板，将 ManipulationMode 值设置为 None，因此，None 将是在设计时所看到的默认值。</p>
<p>指定相关的操作模式<br>你可以在代码或 XAML 中使用所示的逗号语法将多个按标志的 ManipulationModes 值指定为 ManipulationMode 属性的值。例如，可以合并 TranslateX、TranslateY、Rotate 和 Scale，或者它们的任意组合。但是，并非所有组合都有效。仅当特定控件使用 ManipulationModes 后，才会强制实施有效性，因此设置存在的问题（ManipulationModes 的无效组合）不到运行时可能不会出现。不要合并 Translate<em> 值与 TranslateRails</em> 值，因为它们被视为独占值，不合并惯性值与非惯性值。All 值不是所有标志的实际附加值，因此，All 不一定表示所有值的组合有效，或已设置任何特定值。<br>在 Windows 8 上，如果将 ManipulationMode 设置为一个将 System 与其他值组合的值，将会引发异常。从 Windows 8.1 开始，你可以将 System 与其他值结合使用。</p>
</blockquote>
<p>简单理解为：如果我们想要使用<code>Manipulation**</code>事件的话，在使用时必须将该控件的<code>ManipulationMode</code>修改为非<code>System</code>和<code>None</code>，否则系统将会接管触摸事件。</p>
<p>那回到这次的主题，我们想在<code>ScrollViewer</code>上对它作水平方向的平移该怎么做呢？本来我以为只要在ScrollViewer上修改它的<code>ManipulationMode</code>就可以了，结果修改之后，并没有任何反应，绑定的<code>ManipulationDelta</code>事件并不会响应：</p>
<figure class="highlight xaml"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">ScrollViewer</span> <span class="attribute">x:Name</span>=<span class="value">"sv"</span> <span class="attribute">Height</span>=<span class="value">"200"</span> <span class="attribute">ManipulationMode</span>=<span class="value">"TranslateX"</span> <span class="attribute">ManipulationDelta</span>=<span class="value">"UIElement_OnManipulationDelta"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">Border</span> <span class="attribute">Height</span>=<span class="value">"600"</span> <span class="attribute">Background</span>=<span class="value">"Red"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">TextBlock</span>&gt;</span>1<span class="tag">&lt;/<span class="title">TextBlock</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">Border</span>&gt;</span>
<span class="tag">&lt;/<span class="title">ScrollViewer</span>&gt;</span>
</pre></td></tr></table></figure>

<figure class="highlight csharp"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">UIElement_OnManipulationDelta</span>(<span class="keyword">object</span> sender, ManipulationDeltaRoutedEventArgs e)
{
    Debug.WriteLine(e.Delta.Translation.X);
}
</pre></td></tr></table></figure>

<p>后面想了一下，会不会是因为它的子控件<code>Border</code>上的事件被截获了呢？于是我又改了一下，在<code>Border</code>上绑定了一个<code>ManipulationDelta</code>事件，结果还是没有响应：</p>
<figure class="highlight xaml"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">ScrollViewer</span> <span class="attribute">x:Name</span>=<span class="value">"sv"</span> <span class="attribute">Height</span>=<span class="value">"200"</span> <span class="attribute">ManipulationMode</span>=<span class="value">"TranslateX"</span> <span class="attribute">ManipulationDelta</span>=<span class="value">"UIElement_OnManipulationDelta"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">Border</span> <span class="attribute">Height</span>=<span class="value">"600"</span> <span class="attribute">Background</span>=<span class="value">"Red"</span> <span class="attribute">ManipulationDelta</span>=<span class="value">"BorderOnManipulationDelta"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">TextBlock</span>&gt;</span>1<span class="tag">&lt;/<span class="title">TextBlock</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">Border</span>&gt;</span>
<span class="tag">&lt;/<span class="title">ScrollViewer</span>&gt;</span>
</pre></td></tr></table></figure>

<p>于是我决定修改一下<code>Border</code>的<code>ManipulationMode</code>。发现如果修改成<code>All</code>，那<code>ScrollViewer</code>就无法正常滚动了，坑大发了。再次研读上面关于<code>ManipulationMode</code>的备注，发现这个属性的比较神奇，如果修改成非<code>System</code>外的值，那将由开发者自己去处理对应的触摸事件（这不就跟IE10开始使用那个坑爹属性<code>-ms-touch-action</code>一样吗？！）。不过XAML App里面对这个属性提供了一个神奇的使用方法：属性组合。也就是<code>ManipulationMode</code>这个属性里面，可以将多个模式组合使用。</p>
<p>也就是说<code>ManipulationMode</code>可以接受以下的设置方式：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="setting">ManipulationMode = <span class="value"><span class="string">"TranslateX,TranslateY,Rotate,Scale"</span></span></span>
</pre></td></tr></table></figure>

<p>那这时候<code>Manipulation**</code>事件会在响应的参数里面给出TranslateX\TranslateY\Rotate\Scale等相应的响应值。</p>
<p>回到主题：这属性跟<code>ScrollViewer</code>有什么关系啊？还是有点关系哈，看示例代码：</p>
<figure class="highlight xaml"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">ScrollViewer</span> <span class="attribute">x:Name</span>=<span class="value">"sv"</span> <span class="attribute">Height</span>=<span class="value">"200"</span> <span class="attribute">ManipulationDelta</span>=<span class="value">"UIElement_OnManipulationDelta"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">Border</span> <span class="attribute">Height</span>=<span class="value">"600"</span> <span class="attribute">Background</span>=<span class="value">"Red"</span> <span class="attribute">ManipulationMode</span>=<span class="value">"System, TranslateX"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">TextBlock</span>&gt;</span>1<span class="tag">&lt;/<span class="title">TextBlock</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">Border</span>&gt;</span>
<span class="tag">&lt;/<span class="title">ScrollViewer</span>&gt;</span>
</pre></td></tr></table></figure>

<p>如果我对<code>ScrollViewer</code>的子控件添加<code>ManipulationMode=&quot;System,TranslateX</code>，那就相当于告诉系统：子控件的触摸事件除了水平方向之外，其它的都按照系统默认的响应处理。</p>
<p>这样一来，子控件就不会截获掉水平方向的触摸事件，而我在上层<code>ScrollViewer</code>的触摸事件绑定也可以正常响应了！</p>
<h3 id="备注">备注</h3>
<p>WinRT下面对触摸事件的处理感觉是怪怪的，没有以前直观。像<code>ScrollViewer</code>的触摸事件响应，如果按照此文的方法做处理，只能针对非滚动方向做截获。意思就是：如果你的<code>ScrollViewer</code>需要水平方向的滚动，那你加上对应的<code>ManipulationMode</code>之后，水平方向的触摸就会交给你自己做处理了，也就是！如果你什么都不处理，你的<code>ScrollViewer</code>就没有办法做水平滚动啦！</p>
<p>所以说，此法只适合在非滚动方向上的触摸事件响应。PS：有用过IE上那个<code>touch-action</code>属性的同学应该挺好理解这问题的。</p>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="http://weibo.com/newdings/"><strong>@cmm是muffinman_</strong></a> - 6月 6 2014</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://blog.edi-c.com"><strong>@chaoming.edc blog</strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"><a href="/post/functionkey-swithcher-workflow.html">一个在Mac上用于快速切换Function Key的Alfred Workflow</a></h1>
  

      <time datetime="2014-06-03T05:37:51.000Z"><a href="/post/functionkey-swithcher-workflow.html">6月 3 2014</a></time>
      
  </header>
    <div class="entry">
      
        <p>最近切换到iOS开发上，每天都在忍受着Xcode和VS之间的异同。Mac上有一些比较脑残的设置（虽然有时候会觉得挺方便）。不过对开发者影响比较大的还是Debug的时候，键盘顶部的Function Keys默认被设置成了OS X上的一些快捷方式。</p>
<p>虽然，MAS（Mac App Store）上有一款可以自动切换Function Key的软件（叫Puala），有兴趣可以自行下载（￥6）。不过Apple提供了AppleScript，可以对OS X系统、GUI等进行编程，快速实现想要的功能。本来是想自己写一个简单的脚本做处理的，结果查阅了一下各大网站，有人已经写过了。我就简单封装成Alfred Workflow，需要的同学自行下载安装。</p>
<p>使用方法：呼出Alfred之后，输入swfn回车即可将按钮功能切换成标准的Function Key。</p>
<p><a href="https://www.dropbox.com/s/ptdtvpsoa1gwzm2/Switch%20FunctionKeys.alfredworkflow" target="_blank">点击下载</a>。</p>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="http://weibo.com/newdings/"><strong>@cmm是muffinman_</strong></a> - 6月 3 2014</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://blog.edi-c.com"><strong>@chaoming.edc blog</strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





<nav id="pagination">
  
  
    <a href="/page/2/" class="alignright next">下一页</a>
  
</nav></div>
    </div>
    <div class="tabbar" onload="divideTabBar()">
	
      <div class="tabbaritem"><a class="next" href="/">Home</a></div>
    
      <div class="tabbaritem"><a class="next" href="/archives/">Archives</a></div>
    
      <div class="tabbaritem"><a class="next" href="/about/">About</a></div>
    
      <div class="tabbaritem"><a class="next" href="/atom.xml">Subscribe</a></div>
    
</div>


  </div>

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.0.min.js"></script>
</body>
</html>