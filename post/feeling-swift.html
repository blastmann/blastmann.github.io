<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Swift使用感受 | @chaoming.edc blog</title>
  <meta name="author" content="chaoming.edc|blastmann">
  
  <meta name="description" content="track my learning">
  
  
  <meta name="keywords" content="windowsphone,windows,xaml,developer,iOS,OSX,productive">
  
  
  <meta property="og:title" content="Swift使用感受"/>
  <meta name="title" content="Swift使用感受"/>

  <meta property="displaydate" content="2014-07-08T01:59:46.000Z"/>

  <meta property="og:site_name" content="@chaoming.edc blog"/>
  <meta name="copyright" content="@chaoming.edc blog"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta property="og:image" content="undefined"/>
  
   <meta name="google-site-verification" content="nTpmJEYYJgba5eVrpd_dfj1W_Ayr-NjZ1vFvhi5aqzI" />
   <meta name="baidu-site-verification" content="QO84kHVH0w" />
   <link rel="apple-touch-icon" href="/icon.png" />
   <link rel="shortcut icon" href="/favicon.png" >
   <link rel="alternate" href="http://blog.edi-c.com/atom.xml" title="@chaoming.edc blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
  <div id="content" class="inner">
    <aside id="sidebar" class="alignleft">
      <div class="navigationBar">
        <a href="/">@chaoming.edc blog</a>
      </div>
    	
  <nav class="widget" id="menu">
	<ul>
    
      <li class="cell"><a class="next" href="/">Home</a><li>
    
      <li class="cell"><a class="next" href="/archives/">Archives</a><li>
    
      <li class="cell"><a class="next" href="/about/">About</a><li>
    
      <li class="cell"><a class="next" href="/atom.xml">Subscribe</a><li>
    
    </ul>
</nav>

  <div class="widget weibo">
<iframe width="100%" height="100" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=110&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=0&isWeibo=0&isFans=0&uid=newdings&verifier=78e1ee4d&colors=ffffff,ffffff,999,000,ecfbfd&dpc=1"></iframe>
</div>

  

  
<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/IE/" style="font-size: 10.00px;">IE</a><a href="/tags/Swift/" style="font-size: 10.00px;">Swift</a><a href="/tags/WPF/" style="font-size: 10.00px;">WPF</a><a href="/tags/alfred/" style="font-size: 10.00px;">alfred</a><a href="/tags/aspnet/" style="font-size: 10.00px;">aspnet</a><a href="/tags/browser/" style="font-size: 10.00px;">browser</a><a href="/tags/csharp/" style="font-size: 10.00px;">csharp</a><a href="/tags/css3/" style="font-size: 12.50px;">css3</a><a href="/tags/dev/" style="font-size: 10.00px;">dev</a><a href="/tags/diary/" style="font-size: 10.00px;">diary</a><a href="/tags/directx/" style="font-size: 10.00px;">directx</a><a href="/tags/fiddler/" style="font-size: 12.50px;">fiddler</a><a href="/tags/google/" style="font-size: 10.00px;">google</a><a href="/tags/iOS/" style="font-size: 10.00px;">iOS</a><a href="/tags/ie/" style="font-size: 10.00px;">ie</a><a href="/tags/ie11/" style="font-size: 10.00px;">ie11</a><a href="/tags/javascript/" style="font-size: 10.00px;">javascript</a><a href="/tags/js/" style="font-size: 10.00px;">js</a><a href="/tags/mac/" style="font-size: 10.00px;">mac</a><a href="/tags/markdown/" style="font-size: 10.00px;">markdown</a><a href="/tags/mvc/" style="font-size: 10.00px;">mvc</a><a href="/tags/note/" style="font-size: 10.00px;">note</a><a href="/tags/notes/" style="font-size: 17.50px;">notes</a><a href="/tags/plugin/" style="font-size: 10.00px;">plugin</a><a href="/tags/productivity/" style="font-size: 10.00px;">productivity</a><a href="/tags/programming/" style="font-size: 12.50px;">programming</a><a href="/tags/python/" style="font-size: 10.00px;">python</a><a href="/tags/reflow/" style="font-size: 10.00px;">reflow</a><a href="/tags/sqlite/" style="font-size: 10.00px;">sqlite</a><a href="/tags/st2/" style="font-size: 17.50px;">st2</a><a href="/tags/summaries/" style="font-size: 10.00px;">summaries</a><a href="/tags/system/" style="font-size: 10.00px;">system</a><a href="/tags/vim/" style="font-size: 10.00px;">vim</a><a href="/tags/vs2012/" style="font-size: 10.00px;">vs2012</a><a href="/tags/vs2013/" style="font-size: 10.00px;">vs2013</a><a href="/tags/web/" style="font-size: 10.00px;">web</a><a href="/tags/webdev/" style="font-size: 20.00px;">webdev</a><a href="/tags/webview/" style="font-size: 12.50px;">webview</a><a href="/tags/windows/" style="font-size: 15.00px;">windows</a><a href="/tags/winrt/" style="font-size: 17.50px;">winrt</a>
  </div>
</div>


    	<footer id="footer" class="inner"><div class="copyright">
  
  &copy; 2014 chaoming.edc|blastmann
  
</div>



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-51731334-1', 'edi-c.com');
  ga('send', 'pageview');

</script></footer>
    </aside>


    <div id="hidden-navigationBar" class="navigationBar">
      <a href="/">@chaoming.edc blog</a>
    </div>
    <div id="main-col" class="alignright">
    <div id="wrapper">
      
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title">Swift使用感受</h1>
  

      <time datetime="2014-07-08T01:59:46.000Z"><a href="/post/feeling-swift.html">7月 8 2014</a></time>
      
  </header>
    <div class="entry">
      
        <h2 id="写在前面">写在前面</h2>
<p>Apple这次发布Swift语言，是想把OC开发者渐渐迁移到新平台上面吧。暂时来说，Swift具备了很多OC不具备的语言特性，更方便智商不够用的开发者来到iOS平台进行开发。但是，Swift离取代OC的日子还有点远。因为Swift的特性还不能完全覆盖OC的所有特性（举个例子：KVO暂时还没有）。所以未来有一段时间都会是两种语言并行使用。</p>
<p>在Xcode 6正式版还没有出来之前，不建议用Swift来做主力开发语言。因为Xcode 6 Beta对Swift的支持实在是有问题（至少在我的机器上是这样）。智能提示经常提示一些乱七八槽的东西，而且崩溃的机率也很大。</p>
<p>所以，暂时还是学好OC比较有用。虽然Swift更安全更方便，但是用OC先摸一下iOS平台上的坑，还是有必要的。</p>
<p>下面的内容有点乱，随便看看就好。</p>
<h2 id="Swift初体验">Swift初体验</h2>
<h3 id="1-_基础点">1. 基础点</h3>
<ol>
<li>有动态语言的语法特征，但用的是类型推导，是编译型语言</li>
<li>有泛型，个人觉得最直观的体现就是Array和Dictionary终于是强类型的了但还有些很神奇的坑。</li>
<li>可空类型，有助于进行链式调用编写。</li>
<li><del>官方文档上没有发现有<code>public</code> \ <code>private</code>等关键字，全部定义都是公有，这样真没有问题么？虽然类型安全了，但是API编写可能存在比较大的风险。</del> Xcode beta4添加了相关定义，已修正这个问题。</li>
<li>var定义的是变量，let定义的是常量（简单理解）。</li>
<li>…这里想到再补充吧</li>
</ol>
<h3 id="2-_闭包">2. 闭包</h3>
<p>闭包就跟OC里面的Block差不多（Block就是一个语法丑了一点的闭包）。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="code"><pre><span class="type">class</span> HTMLElement: NSObject {
    let <span class="property">name</span>: String
    let <span class="type">text</span>: String?
    
    @lazy var asHTML: () -&gt; String = {
        [unowned self] <span class="keyword">in</span>
        <span class="keyword">if</span> let <span class="type">text</span> = self.<span class="type">text</span> {
<span class="command">            return</span> <span class="string">"&lt;\(self.name)&gt;\(text)&lt;/\(self.name)&gt;"</span>
        } <span class="keyword">else</span> {
<span class="command">            return</span> <span class="string">"&lt;\(self.name) /&gt;"</span>
        }
    }
    
    init(<span class="property">name</span>: String, <span class="type">text</span>: String? = nil) {
        self.<span class="property">name</span> = <span class="property">name</span>
        self.<span class="type">text</span> = <span class="type">text</span>
    }
    
    deinit {
        println(<span class="string">"\(name) is being deinitialized"</span>)
    }
}
</pre></td></tr></table></figure>

<h5 id="Nested_Function也算是一种闭包">Nested Function也算是一种闭包</h5>
<figure class="highlight swift"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre>func makeIncrementor<span class="function"><span class="params">(forIncrement amount: Int)</span> -&gt;</span> <span class="function"><span class="params">()</span> -&gt;</span> Int {
    <span class="reserved">var</span> runningTotal = <span class="number">0</span>
    func incrementor<span class="function"><span class="params">()</span> -&gt;</span> Int {
        runningTotal += amount
        <span class="keyword">return</span> runningTotal
    }
    <span class="keyword">return</span> incrementor
}
</pre></td></tr></table></figure>

<h3 id="3-_泛型（赞）">3. 泛型（赞）</h3>
<p>Swift里面可以使用泛型了，但是使用了泛型的话就不能与OC进行对接，这点需要事先声明。因为泛型不可以与OC进行对接，所以下面的代码会出现链接错误：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="class"><span class="keyword">class</span> <span class="title">errorGenericObject</span><span class="inheritance">&lt;<span class="parent">T</span></span>&gt; : <span class="title">NSObject</span> {</span>
    let <span class="symbol">member:</span> <span class="constant">T</span>
    init(<span class="symbol">aMember:</span> <span class="constant">T</span>) {
        <span class="keyword">self</span>.member = aMember
    }
}
</pre></td></tr></table></figure>

<p>反正我把<code>NSObject</code>的继承去掉之后就可以正常使用了，我觉得Xcode在这个提示上面可以更清晰一些，beta3里面如果有这样的编码，编译时只会提示链接错误，而且错误信息也不是很清晰。</p>
<p>官方文档说可以用数组来处理这种问题：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre><span class="variable">@objc</span> <span class="class"><span class="keyword">class</span> <span class="title">errorObj</span><span class="inheritance">&lt;<span class="parent">T</span></span>&gt; {</span>
    private let <span class="symbol">_member:</span> [<span class="constant">T</span>]
    var <span class="symbol">member:</span> <span class="constant">T</span> {
        <span class="keyword">return</span> _member[<span class="number">0</span>]
    }
    
    init(<span class="symbol">aMember:</span> <span class="constant">T</span>) {
        <span class="keyword">self</span>._member = []
        <span class="keyword">self</span>._member[<span class="number">0</span>] = aMember
    }
}
</pre></td></tr></table></figure>

<p>编译后Swift生成的OC类会是这样的：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>SWIFT_CLASS(<span class="string">"_TtC12TestSwiftApp8errorObj"</span>)
<span class="class"><span class="keyword">@interface</span> <span class="title">errorObj</span></span>
<span class="keyword">@end</span>
</pre></td></tr></table></figure>

<p>即使可以编译过了，但泛型相关的信息也会被抹消掉，结果就是这种泛型类无法在OC下使用。</p>
<h3 id="4-_ARC">4. ARC</h3>
<p>ARC的规则与OC里面差不多，需要解决循环引用的地方都建议使用<code>weak</code>或者<code>unowned</code>。<code>unowned</code>适用于变量总是有值的情况，<code>weak</code>则是对普通变量使用的。标明<code>unowned</code>的变量在使用过程中一定要确保它是非空的，否则会造成异常。</p>
<h2 id="与Objetive-C混合使用">与Objetive-C混合使用</h2>
<h3 id="1-_模块引用">1. 模块引用</h3>
<p>从OC代码中引用Swift模块，只需要OC文件中引入对应的头文件，示例：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="array">#import </span><span class="string">"TestSwiftApp-Swift.h"</span>
</pre></td></tr></table></figure>

<p>需要注意的是，<code>TestSwiftApp</code>这个前缀是在Build Settings是进行设置的。可以设置对应的<code>Product Module Name</code>来修改（默认是空，所以使用<code>Product Name</code>进行代替）。</p>
<p>如果要在Swift中使用OC代码，则需要在一个名字为<code>#ProductName#-Bridging-Header.h</code>的头文件中引用所有需要暴露给Swift的模块头文件。</p>
<h3 id="2-_与OC_API的结合使用">2. 与OC API的结合使用</h3>
<h4 id="a-_构造函数的差别">a. 构造函数的差别</h4>
<p>OBJECTIVE-C</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="built_in">UITableView</span> *myTableView = [[<span class="built_in">UITableView</span> alloc] initWithFrame:CGRectZero style:UITableViewStyleGrouped];
In Swift, you <span class="keyword">do</span> <span class="keyword">this</span>:
</pre></td></tr></table></figure>

<p>SWIFT</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>let myTableView: <span class="built_in">UITableView</span> = <span class="built_in">UITableView</span>(frame: CGRectZero, style: <span class="variable">.Grouped</span>)
</pre></td></tr></table></figure>

<h4 id="b-_id类型与AnyObject">b. id类型与AnyObject</h4>
<p>挺容易理解，id类型在Swift里面对应的就是AnyObject了。与OC混合使用的时候，难免会遇到NSArray、NSDictionary相互转换的情况，从OC转换过来的数组和字典里面所存的数据都是用AnyObject，转换后可以通过<code>as?</code>进行安全的类型转换。</p>
<h3 id="3-_@objc标记">3. @objc标记</h3>
<p>如果你的类不是继承自NSObject或者OC编写的类，但又想兼容OC，可以使用<code>@objc</code>标记。</p>
<h3 id="4-_内省方法">4. 内省方法</h3>
<p>OC里面可以使用<code>isKindOfClass:</code>之类的方法进行对象的类型判断，Swift中可以直接通过<code>is</code>、<code>as</code>这两个关键字进行代替。</p>
<h3 id="5-_OC混合编程中无法使用的Swift特性">5. OC混合编程中无法使用的Swift特性</h3>
<ul>
<li>Generics：泛型</li>
<li>Tuples：元组</li>
<li>Enumerations defined in Swift：定义在Swift中的枚举类型</li>
<li>Structures defined in Swift：定义在Swift中的值类型</li>
<li>Top-level functions defined in Swift：定义在Swift中的最上层函数？（一些工具类的函数可能会写在一个Swift文件中，但不属于任何类）</li>
<li>Global variables defined in Swift：全局变量</li>
<li>Typealiases defined in Swift：类型别名</li>
<li>Swift-style variadics：Swift的可变参数</li>
<li>Nested types：nested类型</li>
<li>Curried functions：咖喱函数（我的智商暂时不够用，理解不了）</li>
</ul>
<h2 id="似乎有些坑的地方">似乎有些坑的地方</h2>
<p>都已经到Xcode beta3了，Swift开发环境还是一堆堆的坑，下面简单记录一下。</p>
<h3 id="1-_Xcode自动补全没反应，索引服务经常挂掉。">1. Xcode自动补全没反应，索引服务经常挂掉。</h3>
<p>坑爹的是我输入一个<code>for</code>，感觉它应该给我提示自动补全一个for循环吧，结果它竟然给我提示<code>fork()</code>！而且提示里面还没有for循环的选项可以用！</p>
<h3 id="2-_delegate模式的使用">2. delegate模式的使用</h3>
<figure class="highlight swift"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="code"><pre><span class="comment">//@class_protocol protocol ModalViewControllerDelegate {</span>
@objc protocol ModalViewControllerDelegate {
    func modalViewControllerDidClickedDismissButton(viewController: ModalViewController)
}

class ModalViewController: <span class="built_in">UIViewController</span> {
    <span class="comment">// 使用weak关键字意图解决循环引用</span>
    <span class="keyword">weak</span> var delegate: ModalViewControllerDelegate?
    override func viewDidLoad() {
        <span class="keyword">super</span><span class="variable">.viewDidLoad</span>()

        <span class="comment">// Do any additional setup after loading the view.</span>
        <span class="keyword">if</span> let sView = <span class="keyword">self</span><span class="variable">.view</span> {
            sView<span class="variable">.backgroundColor</span> = <span class="built_in">UIColor</span><span class="variable">.lightGrayColor</span>()
            
            <span class="keyword">if</span> let button = <span class="built_in">UIButton</span><span class="variable">.buttonWithType</span>(UIButtonType<span class="variable">.System</span>) as? <span class="built_in">UIButton</span> {
                button<span class="variable">.frame</span> = <span class="built_in">CGRect</span>(x: <span class="number">80</span>, y: <span class="number">210</span>, width: <span class="number">160</span>, height: <span class="number">40</span>)
                button<span class="variable">.setTitle</span>(<span class="string">"Dismiss me"</span>, forState: UIControlState<span class="variable">.Normal</span>)
                button<span class="variable">.addTarget</span>(<span class="keyword">self</span>, action: <span class="string">"buttonClicked:"</span>, forControlEvents: UIControlEvents<span class="variable">.TouchUpInside</span>)
                
                <span class="keyword">self</span><span class="variable">.view</span><span class="variable">.addSubview</span>(button)
            }
        }
    }

    override func didReceiveMemoryWarning() {
        <span class="keyword">super</span><span class="variable">.didReceiveMemoryWarning</span>()
        <span class="comment">// Dispose of any resources that can be recreated.</span>
    }
    
    func buttonClicked(sender: AnyObject) {
        <span class="keyword">self</span><span class="variable">.delegate</span>?<span class="variable">.modalViewControllerDidClickedDismissButton</span>(<span class="keyword">self</span>)
    }
}
</pre></td></tr></table></figure>

<p>使用delegate模式时，一般都会用<code>weak</code>去解决循环引用。但直接使用<code>weak</code>的话，编译器会提示</p>
<blockquote>
<p><code>weak</code> cannot be applied to non-class type <code>xxxx</code></p>
</blockquote>
<p><a href="http://stackoverflow.com/questions/24066304/how-can-i-make-a-weak-protocol-reference-in-pure-swift-w-o-objc" target="_blank">StackOverflow上说这种情况</a>需要对protocol添加关键字<code>@objc</code>或者<code>@class_protocol</code>。但现阶段使用后者的话，运行的时候程序会Crash。这是Bug吧？</p>
<h3 id="3-_[unowned_self]导致崩溃">3. <code>[unowned self]</code>导致崩溃</h3>
<p>OC里面，当我们在使用heap block的时候，会注意到如果在block中对self进行引用的话，很容易会造成循环引用导致的内存泄漏。这时我们会使用<code>__weak</code>关键字解决这问题，例如：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>- (<span class="keyword">void</span>)startPolling {
    __<span class="keyword">weak</span> EOCClass *weakSelf = <span class="keyword">self</span>;
    _pollTimer = [NSTimer eoc_scheduledTimerWithTimeInterval:<span class="number">5.0</span>
                                                       block:^{
                                                    EOCClass *strongSelf = weakSelf;
                                                    [strongSelf p_doPoll];
                                                        }
                                                    repeats:<span class="literal">YES</span>];
}
</pre></td></tr></table></figure>

<p>在Swift中，使用属性或方法返回闭包时，官方文档上说也可以使用<code>unowned</code>关键字解决这问题。用<code>weak</code>的话应该也可以，例如：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="code"><pre><span class="regexp">//</span> 使用unowned
<span class="reserved">var</span> <span class="attribute">asHTML</span>: <span class="function"><span class="params">()</span> -&gt;</span> String = {
    [unowned self] <span class="keyword">in</span>
    <span class="keyword">if</span> <span class="reserved">let</span> text = self.text {
        <span class="keyword">return</span> <span class="string">"&lt;\(self.name)&gt;\(text)&lt;/\(self.name)&gt;"</span>
    } <span class="keyword">else</span> {
        <span class="keyword">return</span> <span class="string">"&lt;\(self.name) /&gt;"</span>
    }
}

<span class="regexp">//</span> 使用weak
<span class="reserved">var</span> <span class="attribute">asHTML</span>: <span class="function"><span class="params">()</span> -&gt;</span> String = {
    [weak self] <span class="keyword">in</span>
    <span class="keyword">if</span> <span class="reserved">let</span> text = self?.text {
        <span class="keyword">return</span> <span class="string">"&lt;\(self?.name)&gt;\(text)&lt;/\(self?.name)&gt;"</span>
    } <span class="keyword">else</span> {
        <span class="keyword">return</span> <span class="string">"&lt;\(self?.name) /&gt;"</span>
    }
}
</pre></td></tr></table></figure>

<p>测试结果暂时显示，使用<code>unowned</code>的话会导致Crash。这估计是坑吧……</p>
<h3 id="4-_多线程">4. 多线程</h3>
<p>用Swift重写了一次PrimeFinder，多线程方面还是可以正常使用GCD提供的功能，就是一些block的生成需要注意一下，把语法改一下就好。</p>
<p>由于Swift里面暂时没找到<code>@synchronized</code>这加锁的语法，可以暂时会用下面的代码代替。用<code>NSLock</code>之类的代替也可以。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>objc_sync_enter(self)
<span class="keyword">...</span>
objc_sync_exit(self)
</pre></td></tr></table></figure>

<p>注意一下加锁的对象就好。在重写的时候发现了一个死锁的情况，例如：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="code"><pre>class PrimeFinder {
    var primes: [Int] = []
<span class="keyword">...</span>

    func start() {
<span class="keyword">...</span>
        let isPrime: dispatch_block_t = {
            [weak self] <span class="keyword">in</span>
            <span class="keyword">for</span> (var n = <span class="number">2</span>; n &lt; number; n++) {
                <span class="keyword">if</span> ((number % n) == <span class="number">0</span>) {
                    <span class="keyword">return</span>
                }
            }
            
            objc_sync_enter(self?.primes)
            self?.primes.append(number)
            objc_sync_exit(self?.primes)
        }
<span class="keyword">...</span>
    }
}
</pre></td></tr></table></figure>

<p>在加锁的时候使用的是<code>self?.primes</code>可能为空，导致死锁。如果单独使用一个常量<code>let syncObject: NSObject</code>来代替的话则没有问题。另外，block里面使用<code>unowned</code>似乎是一件很危险的事情，经常会出现Crash。</p>
<h3 id="5-_Playground有何用？">5. Playground有何用？</h3>
<p>新建一个Playground文件，里面有所见即所得的编程体验，编写的代码可以立刻从Playground里面反映出来。但是，<a href="http://stackoverflow.com/questions/24045245/how-to-import-own-classes-from-your-own-project-into-a-playground" target="_blank">对于自定义类来说，在Playground里面暂时无法引用</a>。</p>
<p>简单粗暴的方法是：源码复制粘贴到Playground里面再使用。</p>

	 
	     <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="http://weibo.com/newdings/"><strong>@cmm是muffinman_</strong></a> - 7月 8 2014</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://blog.edi-c.com"><strong>@chaoming.edc blog</strong></a></span>
</p>
       	 
      
    </div>
    <footer>
      
	 
     		  
       		
  
  <div class="tags">
    <a href="/tags/iOS/">iOS</a>, <a href="/tags/Swift/">Swift</a>
  </div>

     		  
       	 
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">留言</h1>




<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'blastmannonscriptogram'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</section>

</div>
    </div>
    <div class="tabbar" onload="divideTabBar()">
	
      <div class="tabbaritem"><a class="next" href="/">Home</a></div>
    
      <div class="tabbaritem"><a class="next" href="/archives/">Archives</a></div>
    
      <div class="tabbaritem"><a class="next" href="/about/">About</a></div>
    
      <div class="tabbaritem"><a class="next" href="/atom.xml">Subscribe</a></div>
    
</div>


  </div>

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.0.min.js"></script>
</body>
</html>